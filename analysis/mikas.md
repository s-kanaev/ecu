# МИКАС 7

## Железо

### Вход ДПКВ

Ожидание (возможного) - выход датчика (или его вход в 'мозок') логический. Смысл сигнала -
срез (переход ```0-1``` или ```1-0```) есть сообщение о провороте коленвала на некую дельту.
Должно быть обозначение "ноля" или "начала отсчёта" (ВМТ первого цилиндра).

Ожидание (невозможного, ибо три провода всего) - выход есть готовое значение положения коленвала (энкодер).

| Название | Клемма |
| -------- | ------ |
| "+"      | 49     |
| "-"      | 48     |

Назначение компонентов:
* C17 - шунт на входе;
* R15 - разрядник для C17;
* R17 - ограничитель тока через VD1.1, VD1.2;
* C16, C22 - ??? // приведение к имеющемуся "нулю"?;
* DA2-1 - триггер Шмитта;
* VD1.1, VD1.2 - ограничитель входного напряжения, диоды типа BAS70 или 1N4148, ```V_f = 0.5 V (approx.)```
* R12, R13 - задают ширину петли гистерезиса на DA2-1;
* R19, R20 - делитель напряжения (```1-1 => 2.5 V```), который:
    - задаёт центр петли гистерезиса;
    - задаёт смещение ограничителя входного напряжения.

Ширина петли гистерезиса: ```H = (R12 / R13) * 5V = 0.1 V (approx.)```.
Верхний порог ```V_high = 2.5 + 0.1 = 2.6 V```, нижний порог ```V_low = 2.5 - 0.1 = 2.4 V```.

Ограничитель входного напряжения: ```2.5 - 0.5 ... 2.5 + 0.5 = 2 .. 3 V```.
Преобразование происходит из диапазона ```-250 .. 250 V``` в диапазон ```2 .. 3 V```
посредством ограничения (обрезания) до ```-0.5 .. 0.5 V``` и смещение на ```+2.5 V```.

DA2-1 преобразует имеющиеся ```2 .. 3 V``` в логические уровни (```0 V``` и ```+5 V```).
Порог переключения в 'единицу' - ```2.6 V```, в 'ноль' - ```2.4 V```.

Разность напряжений на выходе ДПКВ, равная ```0 V```, говорит о прохождении середины зуба.
Граница перехода выхода триггера DA2-1 в любую сторону говорит об уже случившемся прохождении середины зуба.
Вот такая бяка...

Выход триггера DA2-1 уходит напрямую в 'мозок' SAF-C509L на ногу ```P1.3```.

ВМТ первого и четвёртого цилиндров совпадает с 20-м (после выреза) зубом синхродиска.
Один зуб, вместе с промежутком до следующего, имеет ширину 6 градусов оборота ДПКВ.
На синхродиске 58 зубов (схема ```60 - 2```).

Ожидание (возможного) оправдалось. Начало отсчёта имеется. Правда, оно не совсем ВМТ первого цилиндра.
Точнее, совсем не ВМТ. Возможное объяснение -- так сделано для лучшего удобства счёта.

### Вход ДПРВ

Ожидание - выход логический, срез 0-1 сигнализирует о том, что следующее начало отсчёта совпадёт с ВМТ первого цилиндра.

Из "камасутры". ДПРВ позволяет определить ВМТ такта сжатия (перед рабочим ходом) первого цилиндра.
При положении середины отметчика (на распредвале) относительно оси ДПРВ коленвал должен быть повёрнут в положение,
при котором середина первого после выреза зуба синхродиска совпадает с осью ДПКВ.
Ширина отметчика распредвала составляет не менее ```24 +/- 1``` градус положения распредвала или ```12 +/- 0.5``` градус положения коленвала.

| Название | Клемма |
| -------- | ------ |
| Сигнал   | 8      |

Назначение компонентов:
* C30, R26, R30, C31 - фильтр.

Сигнал - проходит через ФВЧ с частотой среза около 7961Гц.

Считываются показания датчика с ноги ```P1.2``` мозгов SAF-C509L.

Сигнал с ДПРВ трактуется только как "есть/нет".
Такой сигнал формируется лишь однажды за два оборота коленвала.

Один раз за два оборота колена датчик выдаст сигнал.
При частоте вращения коленвала в ```5k``` датчик выдаст сигнал с частотой ```2.5 kHz```.
Что вполне укладывается в частоту среза.

Ожидание оправдалось.

### Вход ДМРВ

Питание датчик получает от главного реле. Оттуда же питается нога 37 мозгов.

Схем две. Для плёночного и нитевого ДМРВ.

Ожидание - используется аналоговый вход "мізків" (процессора).
Аналоговое значение преобразуется в значение расхода воздуха (кг/час) через тарировочную таблицу.
Прожиг управляется от мозгов через реле.

| Название                          | Клемма |
| --------------------------------- | ------ |
| "+"                               | 7      |
| "-"                               | 6      |
| Прожиг                            | 31     |
| Потенциометр регулировки CO       | 36     |

#### Плёнка

Клемма потенциометра корректировки CO заземлена через конденсатор.
"Минус" опущен на землю через перемычку.
"Плюс" - проходит через ФВЧ с частотой среза около 361Гц и попадает на ногу ```P8.3``` процессора.

#### Прожиг

Прожиг управляется через ИС HIP0045, нога ```OUT4```.

Этот HIP0045 управляется мозгами так:

| HIP0045 input | SAF-C509L output |
| ------------- | ---------------- |
| ```MOSI```    | ```P5.5```       |
| ```MISO```    | ```P5.7```       |
| ```CLK```     | ```P5.6```       |
| ```!CE```     | ```P6.6```       |
| ```IN0```     | ```P5.4```       |
| ```IN1```     | ```P9.1```       |
| ```!RESET```  | Софья Львовна, вы будете смеятся, но оно болтается в воздухе как то НЛО |

Ожидания оправдались.

#### Нитка

Выходы потенциометра и "плюса" значения массового расхода воздуха включены по схеме
дифференциального усилителя относительно "минуса", который, кстати, опущен на "ноль" через перемычку.

Дифф-усилители имеют некий гистерезис.

Потенциометр заходит на ногу ```P8.0``` процессора. Значение расхода - на ногу ```P8.3```.

Прожиг управляется аналогично "плёнке".

Ожидания оправдались.

### Вход ДПДЗ

Ожидание - используется аналоговый вход процессора.

Из "камасутры". Сам датчик представляет собой делитель напряжения.
При полностью закрытом дросселе выходное напряжение в пределах ```0.25 .. 0.65 V```.
При полностью открытом - напряжение на выходе пределах ```3.9 .. 4.7 V```.
Сопротивление - в пределах ```1.8 .. 2 kOhm```.

| Название | Клемма |
| -------- | ------ |
| Сигнал   | 53     |
| `+U`     | 12     |
| `GND`    | 30     |

Назначение компонентов:
 * C4, R4, R1, C5 - фильтр.

Сигнал - проходит через ФВЧ с частотой среза около 361Гц и попадает на ногу ```P8.4``` процессора.

Ожидания - оправдались.

### Вход ДТВ/ДТОЖ

Ожидание - используется аналоговый вход процессора.

Из "камасутры". Датчик представляет собой залитую компаундом ИС [К1019ЕП1](http://tec.org.ru/board/k1019cht1/139-1-0-508).
Ближайший аналог - LM135 (по слухам, не сверял).

| Название     | Клемма |
| ------------ | ------ |
| Сигнал ДТВ   | 44     |
| Сигнал ДТОЖ  | 45     |

Сигнальная клемма одновременно есть и питательная. Однако, питание датчику нужно подавать от источника тока.
Характеристика датчика линейная при питании датчика током в ```1 mA```.

Сигнал ДТВ - проходит через ФВЧ с частотой среза около 361Гц и попадает на ногу ```P8.6``` процессора.
Сигнал ДТОЖ - аналогично и попадает на ногу ```P7.7``` процессора.

Каждый датчик питается от источника питания ```5 V``` через сопротивление ```1.8 kOhm```.
То есть предельный ток - ```2.78 mA```. Маленько не сходится ток питания с предельным для ИС (```0.45 .. 2.5 mA```).
Однако, по тарировочной таблице с номинальным током (```1 mA```), при температуре ```-45 C```
разность потенциалов на выходе составит ```2.23 ... 2.33 V```. Получаем сопротивление ```2230 .. 2330 Ohm```.
В купе с имеющимся ```1.8 kOhm``` получим ток ```1 mA (approx)```.
При температуре ```125 C``` разность потенциалов на выходе составит ```3.95 .. 4.01 V```.
Это даёт сопротивление ```3950 .. 4010 Ohm```.
В совокупности с имеющимся ```1.8 kOhm``` это даёт ток ```0.86 mA (approx)```.

Ожидания оправдались.

### Вход ДД

Ожидание - используется логический вход процессора. Сигнал ```1``` говорит, что имеет место детонация.

| Название     | Клемма |
| ------------ | ------ |
| Сигнал ДД1   | 11     |
| Сигнал ДД2   | 41     |

Сигнал датчика через конденсатор (для отсечения постоянной составляющей) поступает на вход ИС HIP9010 или HIP9011.

Эта ИС управляется "мозгами" так:

| `HIP9010` / `HIP9011` | SAF-C509L |
| --------------------- | --------- |
| `MISO`                | `NC`      |
| `MOSI`                | `P1.5`    |
| `SCK`                 | `P9.6`    |
| `OSCIN`               | `P1.6`    |
| `OSCOUT`              | `NC`      |
| `INTEGRATE/!HOLD`     | `P1.4`    |
| `INTEGRAL OUTPUT`     | `P7.0`    |
| `!TEST`               | `NC`      |
| `!CS`                 | `P9.7`    |

Ноги `S0IN`, `S0FB` и соответствующие входы второго канала использованы по назначению для подключения обоих датчиков.

Сигнал с датчика не логический, а аналоговый. В добавок, двигатель - штука вибрирующая постоянно.
В рабочем режиме датчик генерирует ЭДС с некоторой амплитудой и характеристикой. Назовём этот сигнал штатным.
Детонация сопровождается (или предваряется) неким "шумом" среди "штатного" сигнала.

Суть работы HIP9010/HIP9011 заключается в фильтрации входного сигнала с последующим интегрированием за некий
промежуток времени. Входы `SPI (MOSI, SCK)` использутся для установки параметров фильтра и длительности промежутка
времени, за который нужно делать интегрирование. Выход - аналоговый.

Ожидания - разбились о скалы действительности и физики. Используется аналоговый вход.
Превышение интегрального значения некоего порога говорит а наличии детонации.

### Вход L-зонда

